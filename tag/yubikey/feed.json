{
    "version": "https://jsonfeed.org/version/1",
    "title": "null • All posts by \"yubikey\" tag",
    "description": "(づ●─●)づ让我看看再学点什么好",
    "home_page_url": "https://www.taoidle.com",
    "items": [
        {
            "id": "https://www.taoidle.com/2024/11/20/Yubikey&Canokey%20PIV%20%E9%85%8D%E7%BD%AE/",
            "url": "https://www.taoidle.com/2024/11/20/Yubikey&Canokey%20PIV%20%E9%85%8D%E7%BD%AE/",
            "title": "Yubikey&Canokey PIV 配置",
            "date_published": "2024-11-20T03:40:23.000Z",
            "content_html": "<h1 id=\"准备\"><a class=\"anchor\" href=\"#准备\">#</a> 准备</h1>\n<ul>\n<li>Yubikey &amp; Canokey</li>\n<li><a href=\"%5BReleases%5D(https://developers.yubico.com/yubico-piv-tool/Releases/)\">yubico-piv-tool</a> &amp; <a href=\"%5BReleases%5D(https://developers.yubico.com/yubikey-manager/Releases/)\">ykman</a></li>\n<li>[WinCryptSSHAgent (Windows)](<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2J1cHRjenEvV2luQ3J5cHRTU0hBZ2VudA==\">buptczq/WinCryptSSHAgent: Using a Yubikey for SSH Authentication on Windows Seamlessly</span>)</li>\n</ul>\n<h1 id=\"生成私钥及证书\"><a class=\"anchor\" href=\"#生成私钥及证书\">#</a> 生成私钥及证书</h1>\n<h2 id=\"ca-私钥和证书\"><a class=\"anchor\" href=\"#ca-私钥和证书\">#</a> CA 私钥和证书</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl genpkey -algorithm RSA -out ca_private_key.pem -pkeyopt rsa_keygen_bits:2048</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>openssl req -new -x509 -key ca_private_key.pem -out ca_cert.pem -days <span class=\"token number\">3650</span> -subj <span class=\"token string\">\"/C=CN/ST=Guangdong/L=Guangzhou/O=XXX/OU=XXX/CN=taoidle\"</span></pre></td></tr></table></figure><h2 id=\"rsa-私钥和csr\"><a class=\"anchor\" href=\"#rsa-私钥和csr\">#</a> RSA 私钥和 CSR</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl genpkey -algorithm RSA -out rsa_private_key.pem -pkeyopt rsa_keygen_bits:2048</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>openssl req -new -key rsa_private_key.pem -out csr.pem -subj <span class=\"token string\">\"/C=CN/ST=Guangdong/L=Guangzhou/O=XXX/OU=XXX/CN=taoidle\"</span></pre></td></tr></table></figure><h2 id=\"使用ca签发csr\"><a class=\"anchor\" href=\"#使用ca签发csr\">#</a> 使用 CA 签发 CSR</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 -req -in csr.pem -CA ca_cert.pem -CAkey ca_private_key.pem -CAcreateserial -out signed_cert.pem -days <span class=\"token number\">3650</span></pre></td></tr></table></figure><h2 id=\"证书验证\"><a class=\"anchor\" href=\"#证书验证\">#</a> 证书验证</h2>\n<h3 id=\"csr验证\"><a class=\"anchor\" href=\"#csr验证\">#</a> CSR 验证</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl req -in csr.pem -noout -text</pre></td></tr></table></figure><h3 id=\"验证生成证书\"><a class=\"anchor\" href=\"#验证生成证书\">#</a> 验证生成证书</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 -in signed_cert.pem -noout -text</pre></td></tr></table></figure><h3 id=\"证书链验证\"><a class=\"anchor\" href=\"#证书链验证\">#</a> 证书链验证</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl verify -CAfile ca_cert.pem signed_cert.pem</pre></td></tr></table></figure><h3 id=\"自签证书链验证\"><a class=\"anchor\" href=\"#自签证书链验证\">#</a> 自签证书链验证</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl verify -CAfile signed_cert.pem signed_cert.pem</pre></td></tr></table></figure><ul>\n<li><code>ca_private_key.pem</code> ：CA 私钥。</li>\n<li><code>ca_cert.pem</code> ：自签名 CA 证书。</li>\n<li><code>rsa_private_key.pem</code> ： RSA 私钥。</li>\n<li><code>csr.pem</code> ：证书签名请求。</li>\n<li><code>signed_cert.pem</code> ：CA 签发的证书。</li>\n</ul>\n<h1 id=\"yubikey-piv\"><a class=\"anchor\" href=\"#yubikey-piv\">#</a> Yubikey PIV</h1>\n<h2 id=\"yubico-piv-tool\"><a class=\"anchor\" href=\"#yubico-piv-tool\">#</a> yubico-piv-tool</h2>\n<h3 id=\"导入私钥\"><a class=\"anchor\" href=\"#导入私钥\">#</a> 导入私钥</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yubico-piv-tool -a import-key -s 9a -i rsa_private_key.pem</pre></td></tr></table></figure><h3 id=\"导入证书\"><a class=\"anchor\" href=\"#导入证书\">#</a> 导入证书</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yubico-piv-tool -a import-key -s 9a -i signed_cert.pem</pre></td></tr></table></figure><h2 id=\"ykman\"><a class=\"anchor\" href=\"#ykman\">#</a> ykman</h2>\n<ul>\n<li>把 rsa_private_key.pem、signed_cert.pem cat 出来，对应到私钥、证书，输入后留空一行然后 ctrl+c 取消后输入 pin</li>\n</ul>\n<h3 id=\"导入私钥-2\"><a class=\"anchor\" href=\"#导入私钥-2\">#</a> 导入私钥</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ykman piv keys <span class=\"token function\">import</span> 9a -</pre></td></tr></table></figure><h3 id=\"导入证书-2\"><a class=\"anchor\" href=\"#导入证书-2\">#</a> 导入证书</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ykman piv certificates <span class=\"token function\">import</span> 9a -</pre></td></tr></table></figure><h1 id=\"canokey-piv\"><a class=\"anchor\" href=\"#canokey-piv\">#</a> Canokey PIV</h1>\n<h2 id=\"yubico-piv-tool-2\"><a class=\"anchor\" href=\"#yubico-piv-tool-2\">#</a> yubico-piv-tool</h2>\n<h3 id=\"导入私钥-3\"><a class=\"anchor\" href=\"#导入私钥-3\">#</a> 导入私钥</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yubico-piv-tool -r canokey -a import-key -s 9a -i rsa_private_key.pem</pre></td></tr></table></figure><h3 id=\"导入证书-3\"><a class=\"anchor\" href=\"#导入证书-3\">#</a> 导入证书</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yubico-piv-tool -r canokey -a import-key -s 9a -i signed_cert.pem</pre></td></tr></table></figure><h2 id=\"ykman-2\"><a class=\"anchor\" href=\"#ykman-2\">#</a> ykman</h2>\n<ul>\n<li>把 rsa_private_key.pem、signed_cert.pem cat 出来，对应到私钥、证书，输入后留空一行然后 ctrl+c 取消后输入 pin</li>\n</ul>\n<h3 id=\"导入私钥-4\"><a class=\"anchor\" href=\"#导入私钥-4\">#</a> 导入私钥</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ykman -r canokey piv keys <span class=\"token function\">import</span> 9a -</pre></td></tr></table></figure><h3 id=\"导入证书-4\"><a class=\"anchor\" href=\"#导入证书-4\">#</a> 导入证书</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ykman -r canokey piv certificates <span class=\"token function\">import</span> 9a -</pre></td></tr></table></figure><h1 id=\"ssh自动登录\"><a class=\"anchor\" href=\"#ssh自动登录\">#</a> SSH 自动登录</h1>\n<h2 id=\"windows\"><a class=\"anchor\" href=\"#windows\">#</a> Windows</h2>\n<p>下载 WinCryptSSHAgent，启动后右键托盘图标 ， <code>show public key</code> 。将公钥放到服务器.ssh/authorized_keys</p>\n",
            "tags": [
                "yubikey",
                "canokeys"
            ]
        },
        {
            "id": "https://www.taoidle.com/2022/06/23/use%20gpg&smart%20card/",
            "url": "https://www.taoidle.com/2022/06/23/use%20gpg&smart%20card/",
            "title": "use gpg&smart card",
            "date_published": "2022-06-23T13:17:40.000Z",
            "content_html": "<h2 id=\"import-key\"><a class=\"anchor\" href=\"#import-key\">#</a> Import Key</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gpg --import <span class=\"token operator\">&lt;</span>key_path<span class=\"token operator\">></span></pre></td></tr></table></figure><p><img data-src=\"https://cdn.assets.taoidle.com/gh/taoidle/taoidle.github.io@master/assets/images/gpg_import(1).png\" alt=\"\" /></p>\n<h2 id=\"list-keys\"><a class=\"anchor\" href=\"#list-keys\">#</a> List Keys</h2>\n<h3 id=\"list-keys-2\"><a class=\"anchor\" href=\"#list-keys-2\">#</a> list keys</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gpg -k</pre></td></tr></table></figure><h3 id=\"list-secret-keys\"><a class=\"anchor\" href=\"#list-secret-keys\">#</a> list secret keys</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gpg -K</pre></td></tr></table></figure><p><img data-src=\"https://cdn.assets.taoidle.com/gh/taoidle/taoidle.github.io@master/assets/images/gpg_import(2).png\" alt=\"\" /></p>\n<h2 id=\"change-the-ownertrust\"><a class=\"anchor\" href=\"#change-the-ownertrust\">#</a> Change The Ownertrust</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gpg --edit-key <span class=\"token operator\">&lt;</span>id<span class=\"token operator\">></span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gpg<span class=\"token operator\">></span> trust</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>y</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>gpg<span class=\"token operator\">></span> quit</pre></td></tr></table></figure><p><img data-src=\"https://cdn.assets.taoidle.com/gh/taoidle/taoidle.github.io@master/assets/images/gpg_import(3).png\" alt=\"\" /></p>\n<h2 id=\"import-to-smart-card\"><a class=\"anchor\" href=\"#import-to-smart-card\">#</a> Import To Smart Card</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gpg --expert --edit-key <span class=\"token operator\">&lt;</span>id<span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"select-key-1-and-import-to-card\"><a class=\"anchor\" href=\"#select-key-1-and-import-to-card\">#</a> Select key 1 and import to card</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gpg<span class=\"token operator\">></span> key <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>gpg<span class=\"token operator\">></span> keytocard</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">2</span></pre></td></tr></table></figure><p><img data-src=\"https://cdn.assets.taoidle.com/gh/taoidle/taoidle.github.io@master/assets/images/gpg_key2card(1).png\" alt=\"\" /></p>\n<h3 id=\"unselect-key-1select-key-2-and-import-to-card\"><a class=\"anchor\" href=\"#unselect-key-1select-key-2-and-import-to-card\">#</a> Unselect key 1,Select key 2 and import to card</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gpg<span class=\"token operator\">></span> key <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>gpg<span class=\"token operator\">></span> key <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>gpg<span class=\"token operator\">></span> keytocard</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr></table></figure><p><img data-src=\"https://cdn.assets.taoidle.com/gh/taoidle/taoidle.github.io@master/assets/images/gpg_key2card(2).png\" alt=\"\" /></p>\n<h3 id=\"unselect-key-2select-key-3-and-import-to-card\"><a class=\"anchor\" href=\"#unselect-key-2select-key-3-and-import-to-card\">#</a> Unselect key 2,Select key 3 and import to card</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gpg<span class=\"token operator\">></span> key <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>gpg<span class=\"token operator\">></span> key <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>gpg<span class=\"token operator\">></span> keytocard</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>gpg<span class=\"token operator\">></span> quit</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>y</pre></td></tr></table></figure><p><img data-src=\"https://cdn.assets.taoidle.com/gh/taoidle/taoidle.github.io@master/assets/images/gpg_key2card(3).png\" alt=\"\" /></p>\n<h2 id=\"print-card-status\"><a class=\"anchor\" href=\"#print-card-status\">#</a> Print Card Status</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gpg --card-status</pre></td></tr></table></figure><p><img data-src=\"https://cdn.assets.taoidle.com/gh/taoidle/taoidle.github.io@master/assets/images/gpg_card_status.png\" alt=\"\" /></p>\n<h2 id=\"bind-smart-card\"><a class=\"anchor\" href=\"#bind-smart-card\">#</a> Bind Smart Card</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gpg-connect-agent <span class=\"token string\">\"scd serialno\"</span> <span class=\"token string\">\"learn --force\"</span> /bye</pre></td></tr></table></figure>",
            "tags": [
                "yubikey",
                "canokeys",
                "gpg"
            ]
        }
    ]
}