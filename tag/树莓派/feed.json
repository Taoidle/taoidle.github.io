{
    "version": "https://jsonfeed.org/version/1",
    "title": "Taoidle • All posts by \"树莓派\" tag",
    "description": "",
    "home_page_url": "https://www.taoidle.com",
    "items": [
        {
            "id": "https://www.taoidle.com/2022/04/09/raspberry-pi4b%E7%A7%81%E6%9C%89%E9%83%A8%E7%BD%B2bitwarden/",
            "url": "https://www.taoidle.com/2022/04/09/raspberry-pi4b%E7%A7%81%E6%9C%89%E9%83%A8%E7%BD%B2bitwarden/",
            "title": "Raspberry Pi4b私有部署Bitwarden",
            "date_published": "2022-04-09T09:10:15.000Z",
            "content_html": "<h2 id=\"准备\"><a class=\"markdownIt-Anchor\" href=\"#准备\">#</a> 准备</h2>\n<ul>\n<li>烧写好系统镜像的 Raspberry Pi4b</li>\n<li>良好的网络环境</li>\n</ul>\n<h2 id=\"开始\"><a class=\"markdownIt-Anchor\" href=\"#开始\">#</a> 开始</h2>\n<ul>\n<li>本文使用 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RhbmktZ2FyY2lhL3ZhdWx0d2FyZGVu\">bitwordken_rs</span></li>\n<li>使用 Docker（树莓派上使用 docker 参考 <a href=\"https://www.taoidle.com/raspberry-pi4b%e5%ae%89%e8%a3%85docker.html\" title=\"Raspberry Pi4b安装Docker\">Raspberry Pi4b 安装 Docker</a>）</li>\n</ul>\n<hr>\n<h3 id=\"下载运行docker镜像\"><a class=\"markdownIt-Anchor\" href=\"#下载运行docker镜像\">#</a> 下载运行 docker 镜像</h3>\n<p><strong>1. 使用 Docker 拉取最新版本的 Bitwarden RS</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull vaultwarden/server:latest</pre></td></tr></table></figure><p><strong>2. 运行 Bitwarden 镜像</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> run -d --name bitwarden  --restart<span class=\"token operator\">=</span>always <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    -v /bw-data/:/data/ -p <span class=\"token number\">127.0</span>.0.1:8080:80 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    -p <span class=\"token number\">127.0</span>.0.1:3012:3012 vaultwarden/server:latest</pre></td></tr></table></figure><p>这里将网络服务器暴露在端口 8080 上，端口 3012，这是 Bitwarden 的 Web 套接字用来进行通信的端口。</p>\n<hr>\n<h3 id=\"配置nginx\"><a class=\"markdownIt-Anchor\" href=\"#配置nginx\">#</a> 配置 NGINX</h3>\n<p><strong>1. 下载 nginx</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> nginx</pre></td></tr></table></figure><p><strong>2. 停止运行 nginx</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> systemctl stop nginx</pre></td></tr></table></figure><p><strong>3. 为 nginx 生成一个 SSL 证书，在 Raspberry Pi 上生成证书有两种不同的方式</strong></p>\n<ul>\n<li>自签证书</li>\n<li>Lets Encrypt 等</li>\n</ul>\n<p><strong>4. 使用以下命令生成自签名证书</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> openssl req -x509 -nodes -days <span class=\"token number\">365</span> -newkey rsa:4096 -keyout /etc/ssl/private/nginx-bitwarden.key -out /etc/ssl/certs/nginx-bitwarden.crt</pre></td></tr></table></figure><p><strong>5. 创建一个 Diffie-Hellman</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> openssl dhparam -out /etc/ssl/certs/dhparam.pem <span class=\"token number\">2048</span></pre></td></tr></table></figure><p><strong>6. 查看 NGINX 的默认配置文件</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> /etc/nginx/nginx.conf</pre></td></tr></table></figure><p><img data-src=\"/assets/images/1649492956-image-1649492954071.png\" alt=\"file\"></p>\n<p><strong>7. 为 NGINX 创建一个新的配置文件</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> /etc/nginx/conf.d/bitwarden.conf</pre></td></tr></table></figure><p><strong>8. 编写配置</strong></p>\n<pre><code>server &#123;\n    listen 80;\n    listen [::]:80;\n    server_name localhost;\n    return 301 https://$host$request_uri;\n&#125;\n\nserver &#123;\n  listen 443 ssl http2;\n  server_name localhost;\n\n  ssl_certificate      /etc/ssl/certs/nginx-bitwarden.crt;\n  ssl_certificate_key  /etc/ssl/private/nginx-bitwarden.key;\n\n  ssl_dhparam /etc/ssl/certs/dhparam.pem;\n\n  client_max_body_size 128M;\n\n  location / &#123;\n    proxy_pass http://0.0.0.0:8080;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n  &#125;\n\n  location /notifications/hub &#123;\n    proxy_pass http://0.0.0.0:3012;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection &quot;upgrade&quot;;\n  &#125;\n\n  location /notifications/hub/negotiate &#123;\n    proxy_pass http://0.0.0.0:8080;\n  &#125;\n&#125;\n</code></pre>\n<p><strong>9. 保存退出重启 NGINX</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> systemctl restart nginx</pre></td></tr></table></figure><hr>\n<h3 id=\"创建-bitwarden-账户\"><a class=\"markdownIt-Anchor\" href=\"#创建-bitwarden-账户\">#</a> 创建 Bitwarden 账户</h3>\n<pre><code>https://你的树莓派ip\n</code></pre>\n<p><img data-src=\"/assets/images/1649494073-image-1649494070786.png\" alt=\"file\"></p>\n<h3 id=\"启用-bitwarden-管理面板\"><a class=\"markdownIt-Anchor\" href=\"#启用-bitwarden-管理面板\">#</a> 启用 Bitwarden 管理面板</h3>\n<p><strong>1. 生成管理员令牌</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl rand -base64 <span class=\"token number\">48</span></pre></td></tr></table></figure><p><strong>2. 停止当前正在运行的容器</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> stop bitwarden</pre></td></tr></table></figure><p><strong>3. 删除现有的 Bitwarden 容器</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> <span class=\"token function\">rm</span> bitwarden</pre></td></tr></table></figure><p><strong>4. 需要重新运行 docker 命令</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> run -d --name bitwarden  -e <span class=\"token assign-left variable\">ADMIN_TOKEN</span><span class=\"token operator\">=</span>你的管理员令牌 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    --restart<span class=\"token operator\">=</span>always -v /bw-data/:/data/ <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    -p <span class=\"token number\">127.0</span>.0.1:8080:80 -p <span class=\"token number\">127.0</span>.0.1:3012:3012 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    vaultwarden/server:latest</pre></td></tr></table></figure><h3 id=\"访问-bitwarden-管理面板\"><a class=\"markdownIt-Anchor\" href=\"#访问-bitwarden-管理面板\">#</a> 访问 Bitwarden 管理面板</h3>\n<p><strong>1. 访问管理面板</strong></p>\n<pre><code>https://你的树莓派ip/admin\n</code></pre>\n<p><img data-src=\"/assets/images/1649495073-image-1649495070774.png\" alt=\"file\"> 输入你的管理员令牌</p>\n<p><strong>2. 管理您的用户以及配置 Bitwarden 的设置</strong></p>\n<p><img data-src=\"/assets/images/1649495182-image-1649495179498.png\" alt=\"file\"></p>\n<h3 id=\"禁用-bitwarden-新用户创建\"><a class=\"markdownIt-Anchor\" href=\"#禁用-bitwarden-新用户创建\">#</a> 禁用 Bitwarden 新用户创建</h3>\n<p><img data-src=\"/assets/images/1649495329-image-1649495327106.png\" alt=\"file\"> <img data-src=\"/assets/images/1649495363-image-1649495361101.png\" alt=\"file\"> <img data-src=\"/assets/images/1649495397-image-1649495394882.png\" alt=\"file\"></p>\n",
            "tags": [
                "Docker",
                "Raspberry Pi4b",
                "树莓派",
                "Bitwarden",
                "树莓派4b"
            ]
        },
        {
            "id": "https://www.taoidle.com/2022/04/09/raspberry-pi4b%E5%AE%89%E8%A3%85docker/",
            "url": "https://www.taoidle.com/2022/04/09/raspberry-pi4b%E5%AE%89%E8%A3%85docker/",
            "title": "Raspberry Pi4b安装Docker",
            "date_published": "2022-04-09T07:22:46.000Z",
            "content_html": "<ol>\n<li>\n<p>更新软件包</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> upgrade</pre></td></tr></table></figure></li>\n<li>\n<p>通过运行以下命令下载并运行官方 Docker 设置脚本</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> -sSL https://get.docker.com  <span class=\"token function\">sh</span></pre></td></tr></table></figure></li>\n<li>\n<p>将 pi 用户添加到 docker 组中</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">usermod</span> -aG <span class=\"token function\">docker</span> pi</pre></td></tr></table></figure></li>\n</ol>\n",
            "tags": [
                "Docker",
                "Raspberry Pi",
                "Raspberry Pi4b",
                "树莓派"
            ]
        }
    ]
}